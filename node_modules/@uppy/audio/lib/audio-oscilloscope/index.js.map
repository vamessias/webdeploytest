{"version":3,"names":["isFunction","v","result","_draw","_classPrivateFieldLooseKey","AudioOscilloscope","constructor","canvas","options","Object","defineProperty","writable","value","draw","canvasOptions","canvasContextOptions","canvasContext","analyser","bufferLength","width","height","getContext","fillStyle","strokeStyle","lineWidth","onDrawFrame","addSource","streamSource","audioContext","context","createAnalyser","fftSize","frequencyBinCount","source","createBufferSource","dataArray","Uint8Array","getByteTimeDomainData","connect","ctx","w","h","fillRect","beginPath","sliceWidth","x","moveTo","i","y","lineTo","stroke","requestAnimationFrame","_classPrivateFieldLooseBase"],"sources":["index.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-types\nfunction isFunction(v: any): v is Function {\n  return typeof v === 'function'\n}\n\nfunction result<T>(v: T): T extends (...args: any) => any ? ReturnType<T> : T {\n  return isFunction(v) ? v() : v\n}\n\ntype MaybeFunction<T> = T | (() => T)\n\ninterface AudioOscilloscopeOptions {\n  canvas?: {\n    width?: number\n    height?: number\n  }\n  canvasContext?: {\n    width?: MaybeFunction<number>\n    height?: MaybeFunction<number>\n    lineWidth?: MaybeFunction<number>\n    fillStyle?: MaybeFunction<string>\n    strokeStyle?: MaybeFunction<string>\n  }\n\n  // eslint-disable-next-line no-use-before-define\n  onDrawFrame?: (oscilloscope: AudioOscilloscope) => void\n}\n\n/* Audio Oscilloscope\n  https://github.com/miguelmota/audio-oscilloscope\n*/\nexport default class AudioOscilloscope {\n  private canvas: HTMLCanvasElement\n\n  private canvasContext: CanvasRenderingContext2D\n\n  private width: number\n\n  private height: number\n\n  private analyser: null | AnalyserNode\n\n  private bufferLength: number\n\n  private dataArray?: Uint8Array\n\n  // eslint-disable-next-line no-use-before-define\n  private onDrawFrame: (oscilloscope: AudioOscilloscope) => void\n\n  private streamSource?: MediaStreamAudioSourceNode\n\n  private audioContext?: BaseAudioContext\n\n  public source?: AudioBufferSourceNode\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    options: AudioOscilloscopeOptions = {},\n  ) {\n    const canvasOptions =\n      options.canvas || ({} as NonNullable<AudioOscilloscopeOptions['canvas']>)\n    const canvasContextOptions =\n      options.canvasContext ||\n      ({} as NonNullable<AudioOscilloscopeOptions['canvasContext']>)\n    this.analyser = null\n    this.bufferLength = 0\n    this.canvas = canvas\n    this.width = result(canvasOptions.width) || this.canvas.width\n    this.height = result(canvasOptions.height) || this.canvas.height\n    this.canvas.width = this.width\n    this.canvas.height = this.height\n    this.canvasContext = this.canvas.getContext('2d')!\n    this.canvasContext.fillStyle =\n      result(canvasContextOptions.fillStyle) || 'rgb(255, 255, 255)'\n    this.canvasContext.strokeStyle =\n      result(canvasContextOptions.strokeStyle) || 'rgb(0, 0, 0)'\n    this.canvasContext.lineWidth = result(canvasContextOptions.lineWidth) || 1\n    this.onDrawFrame =\n      isFunction(options.onDrawFrame) ? options.onDrawFrame : () => {}\n  }\n\n  addSource(streamSource: MediaStreamAudioSourceNode): void {\n    this.streamSource = streamSource\n    this.audioContext = this.streamSource.context\n    this.analyser = this.audioContext.createAnalyser()\n    this.analyser.fftSize = 2048\n    this.bufferLength = this.analyser.frequencyBinCount\n    this.source = this.audioContext.createBufferSource()\n    this.dataArray = new Uint8Array(this.bufferLength)\n    this.analyser.getByteTimeDomainData(this.dataArray)\n    this.streamSource.connect(this.analyser)\n  }\n\n  draw(): void {\n    const { analyser, dataArray, bufferLength } = this\n    const ctx = this.canvasContext\n    const w = this.width\n    const h = this.height\n\n    if (analyser) {\n      analyser.getByteTimeDomainData(dataArray!)\n    }\n\n    ctx.fillRect(0, 0, w, h)\n    ctx.beginPath()\n\n    const sliceWidth = (w * 1.0) / bufferLength\n    let x = 0\n\n    if (!bufferLength) {\n      ctx.moveTo(0, this.height / 2)\n    }\n\n    for (let i = 0; i < bufferLength; i++) {\n      const v = dataArray![i] / 128.0\n      const y = v * (h / 2)\n\n      if (i === 0) {\n        ctx.moveTo(x, y)\n      } else {\n        ctx.lineTo(x, y)\n      }\n\n      x += sliceWidth\n    }\n\n    ctx.lineTo(w, h / 2)\n    ctx.stroke()\n\n    this.onDrawFrame(this)\n    requestAnimationFrame(this.#draw)\n  }\n\n  #draw = () => this.draw()\n}\n"],"mappings":"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","ignoreList":[]}