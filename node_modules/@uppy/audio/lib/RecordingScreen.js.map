{"version":3,"names":["h","useEffect","useRef","RecordButton","RecordingLength","AudioSourceSelect","AudioOscilloscope","SubmitButton","DiscardButton","RecordingScreen","props","stream","recordedAudio","onStop","recording","supportsRecording","audioSources","showAudioSourceDropdown","onSubmit","i18n","onStartRecording","onStopRecording","onDiscardRecordedAudio","recordingLengthSeconds","canvasEl","oscilloscope","current","canvas","width","height","canvasContext","lineWidth","fillStyle","strokeStyle","draw","audioContext","AudioContext","source","createMediaStreamSource","addSource","hasRecordedAudio","shouldShowRecordButton","shouldShowAudioSourceDropdown","length","className","controls","src","ref","onDiscard"],"sources":["RecordingScreen.tsx"],"sourcesContent":["/* eslint-disable jsx-a11y/media-has-caption */\nimport { h } from 'preact'\nimport { useEffect, useRef } from 'preact/hooks'\nimport type { I18n } from '@uppy/utils/lib/Translator'\nimport RecordButton from './RecordButton.tsx'\nimport RecordingLength from './RecordingLength.tsx'\nimport AudioSourceSelect, {\n  type AudioSourceSelectProps,\n} from './AudioSourceSelect.tsx'\nimport AudioOscilloscope from './audio-oscilloscope/index.ts'\nimport SubmitButton from './SubmitButton.tsx'\nimport DiscardButton from './DiscardButton.tsx'\n\ninterface RecordingScreenProps extends AudioSourceSelectProps {\n  stream: MediaStream | null | undefined\n  recordedAudio: string | null | undefined\n  recording: boolean\n  supportsRecording: boolean\n  showAudioSourceDropdown: boolean | undefined\n  onSubmit: () => void\n  i18n: I18n\n  onStartRecording: () => void\n  onStopRecording: () => void\n  onStop: () => void\n  onDiscardRecordedAudio: () => void\n  recordingLengthSeconds: number\n}\n\nexport default function RecordingScreen(props: RecordingScreenProps) {\n  const {\n    stream,\n    recordedAudio,\n    onStop,\n    recording,\n    supportsRecording,\n    audioSources,\n    showAudioSourceDropdown,\n    onSubmit,\n    i18n,\n    onStartRecording,\n    onStopRecording,\n    onDiscardRecordedAudio,\n    recordingLengthSeconds,\n  } = props\n\n  const canvasEl = useRef<HTMLCanvasElement>(null)\n  const oscilloscope = useRef<AudioOscilloscope | null>()\n\n  // componentDidMount / componentDidUnmount\n  useEffect(() => {\n    return () => {\n      oscilloscope.current = null\n      onStop()\n    }\n  }, [onStop])\n\n  // componentDidUpdate\n  useEffect(() => {\n    if (!recordedAudio) {\n      oscilloscope.current = new AudioOscilloscope(canvasEl.current!, {\n        canvas: {\n          width: 600,\n          height: 600,\n        },\n        canvasContext: {\n          lineWidth: 2,\n          fillStyle: 'rgb(0,0,0)',\n          strokeStyle: 'green',\n        },\n      })\n      oscilloscope.current.draw()\n\n      if (stream) {\n        const audioContext = new AudioContext()\n        const source = audioContext.createMediaStreamSource(stream)\n        oscilloscope.current.addSource(source)\n      }\n    }\n  }, [recordedAudio, stream])\n\n  const hasRecordedAudio = recordedAudio != null\n  const shouldShowRecordButton = !hasRecordedAudio && supportsRecording\n  const shouldShowAudioSourceDropdown =\n    showAudioSourceDropdown &&\n    !hasRecordedAudio &&\n    audioSources &&\n    audioSources.length > 1\n\n  return (\n    <div className=\"uppy-Audio-container\">\n      <div className=\"uppy-Audio-audioContainer\">\n        {hasRecordedAudio ?\n          <audio className=\"uppy-Audio-player\" controls src={recordedAudio} />\n        : <canvas ref={canvasEl} className=\"uppy-Audio-canvas\" />}\n      </div>\n      <div className=\"uppy-Audio-footer\">\n        <div className=\"uppy-Audio-audioSourceContainer\">\n          {shouldShowAudioSourceDropdown ? AudioSourceSelect(props) : null}\n        </div>\n        <div className=\"uppy-Audio-buttonContainer\">\n          {shouldShowRecordButton && (\n            <RecordButton\n              recording={recording}\n              onStartRecording={onStartRecording}\n              onStopRecording={onStopRecording}\n              i18n={i18n}\n            />\n          )}\n\n          {hasRecordedAudio && <SubmitButton onSubmit={onSubmit} i18n={i18n} />}\n\n          {hasRecordedAudio && (\n            <DiscardButton onDiscard={onDiscardRecordedAudio} i18n={i18n} />\n          )}\n        </div>\n\n        <div className=\"uppy-Audio-recordingLength\">\n          {!hasRecordedAudio && (\n            <RecordingLength\n              recordingLengthSeconds={recordingLengthSeconds}\n              i18n={i18n}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]}