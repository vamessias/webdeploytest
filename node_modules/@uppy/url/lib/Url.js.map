{"version":3,"names":["h","UIPlugin","RequestClient","toArray","UrlUI","forEachDroppedOrPastedUrl","packageJson","locale","UrlIcon","focusable","width","height","viewBox","d","fill","addProtocolToURL","url","protocolRegex","defaultProtocol","test","canHandleRootDrop","e","items","dataTransfer","urls","filter","item","kind","type","length","checkIfCorrectURL","startsWith","getFileNameFromUrl","pathname","URL","substring","lastIndexOf","Url","constructor","uppy","opts","getMeta","client","post","addFile","protocollessUrl","optionalMeta","log","info","i18n","undefined","meta","tagFile","source","id","name","data","size","isRemote","body","remote","companionUrl","hostname","fileId","requestClientId","err","isRestriction","message","details","handleRootDrop","handleRootPaste","clipboardData","icon","defaultLocale","i18nInit","title","Error","pluginId","provider","companionHeaders","companionCookiesRule","registerRequestClient","render","install","target","mount","uninstall","unmount","_Url","VERSION","version","prototype"],"sources":["Url.tsx"],"sourcesContent":["import { h, type ComponentChild } from 'preact'\nimport { UIPlugin, Uppy } from '@uppy/core'\nimport {\n  RequestClient,\n  type CompanionPluginOptions,\n} from '@uppy/companion-client'\nimport toArray from '@uppy/utils/lib/toArray'\nimport type { TagFile, Meta, Body } from '@uppy/utils/lib/UppyFile'\nimport UrlUI from './UrlUI.tsx'\nimport forEachDroppedOrPastedUrl from './utils/forEachDroppedOrPastedUrl.ts'\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport packageJson from '../package.json'\nimport locale from './locale.ts'\n\nfunction UrlIcon() {\n  return (\n    <svg\n      aria-hidden=\"true\"\n      focusable=\"false\"\n      width=\"32\"\n      height=\"32\"\n      viewBox=\"0 0 32 32\"\n    >\n      <path\n        d=\"M23.637 15.312l-2.474 2.464a3.582 3.582 0 01-.577.491c-.907.657-1.897.986-2.968.986a4.925 4.925 0 01-3.959-1.971c-.248-.329-.164-.902.165-1.149.33-.247.907-.164 1.155.164 1.072 1.478 3.133 1.724 4.618.656a.642.642 0 00.33-.328l2.473-2.463c1.238-1.313 1.238-3.366-.082-4.597a3.348 3.348 0 00-4.618 0l-1.402 1.395a.799.799 0 01-1.154 0 .79.79 0 010-1.15l1.402-1.394a4.843 4.843 0 016.843 0c2.062 1.805 2.144 5.007.248 6.896zm-8.081 5.664l-1.402 1.395a3.348 3.348 0 01-4.618 0c-1.319-1.23-1.319-3.365-.082-4.596l2.475-2.464.328-.328c.743-.492 1.567-.739 2.475-.657.906.165 1.648.574 2.143 1.314.248.329.825.411 1.155.165.33-.248.412-.822.165-1.15-.825-1.068-1.98-1.724-3.216-1.888-1.238-.247-2.556.082-3.628.902l-.495.493-2.474 2.464c-1.897 1.969-1.814 5.09.083 6.977.99.904 2.226 1.396 3.463 1.396s2.473-.492 3.463-1.395l1.402-1.396a.79.79 0 000-1.15c-.33-.328-.908-.41-1.237-.082z\"\n        fill=\"#FF753E\"\n        fill-rule=\"nonzero\"\n      />\n    </svg>\n  )\n}\n\nfunction addProtocolToURL(url: string) {\n  const protocolRegex = /^[a-z0-9]+:\\/\\//\n  const defaultProtocol = 'http://'\n  if (protocolRegex.test(url)) {\n    return url\n  }\n\n  return defaultProtocol + url\n}\n\nfunction canHandleRootDrop(e: DragEvent) {\n  const items = toArray(e.dataTransfer!.items)\n  const urls = items.filter(\n    (item) => item.kind === 'string' && item.type === 'text/uri-list',\n  )\n  return urls.length > 0\n}\n\nfunction checkIfCorrectURL(url?: string) {\n  return url?.startsWith('http://') || url?.startsWith('https://')\n}\n\nfunction getFileNameFromUrl(url: string) {\n  const { pathname } = new URL(url)\n  return pathname.substring(pathname.lastIndexOf('/') + 1)\n}\n\n/*\n * Response from the /url/meta Companion endpoint.\n * Has to be kept in sync with `getURLMeta` in `companion/src/server/helpers/request.js`.\n */\ntype MetaResponse = {\n  name: string\n  type: string\n  size: number | null\n  statusCode: number\n}\n\nexport type UrlOptions = CompanionPluginOptions\n\nexport default class Url<M extends Meta, B extends Body> extends UIPlugin<\n  UrlOptions,\n  M,\n  B\n> {\n  static VERSION = packageJson.version\n\n  static requestClientId = Url.name\n\n  icon: () => h.JSX.Element\n\n  hostname: string\n\n  client: RequestClient<M, B>\n\n  canHandleRootDrop!: typeof canHandleRootDrop\n\n  constructor(uppy: Uppy<M, B>, opts: UrlOptions) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'Url'\n    this.type = 'acquirer'\n    this.icon = () => <UrlIcon />\n\n    // Set default options and locale\n    this.defaultLocale = locale\n\n    this.i18nInit()\n    this.title = this.i18n('pluginNameUrl')\n\n    this.hostname = this.opts.companionUrl\n\n    if (!this.hostname) {\n      throw new Error(\n        'Companion hostname is required, please consult https://uppy.io/docs/companion',\n      )\n    }\n\n    this.client = new RequestClient(uppy, {\n      pluginId: this.id,\n      provider: 'url',\n      companionUrl: this.opts.companionUrl,\n      companionHeaders: this.opts.companionHeaders,\n      companionCookiesRule: this.opts.companionCookiesRule,\n    })\n\n    this.uppy.registerRequestClient(Url.requestClientId, this.client)\n  }\n\n  private getMeta = (url: string): Promise<MetaResponse> => {\n    return this.client.post<MetaResponse>('url/meta', { url })\n  }\n\n  private addFile = async (\n    protocollessUrl: string,\n    optionalMeta?: M,\n  ): Promise<string | undefined> => {\n    const url = addProtocolToURL(protocollessUrl)\n    if (!checkIfCorrectURL(url)) {\n      this.uppy.log(`[URL] Incorrect URL entered: ${url}`)\n      this.uppy.info(this.i18n('enterCorrectUrl'), 'error', 4000)\n      return undefined\n    }\n\n    try {\n      const meta = await this.getMeta(url)\n\n      const tagFile: TagFile<M> = {\n        meta: optionalMeta,\n        source: this.id,\n        name: meta.name || getFileNameFromUrl(url),\n        type: meta.type,\n        data: {\n          size: meta.size,\n        },\n        isRemote: true,\n        body: {\n          url,\n        },\n        remote: {\n          companionUrl: this.opts.companionUrl,\n          url: `${this.hostname}/url/get`,\n          body: {\n            fileId: url,\n            url,\n          },\n          requestClientId: Url.requestClientId,\n        },\n      }\n\n      this.uppy.log('[Url] Adding remote file')\n      try {\n        return this.uppy.addFile(tagFile)\n      } catch (err) {\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n        return err\n      }\n    } catch (err) {\n      this.uppy.log(err)\n      this.uppy.info(\n        {\n          message: this.i18n('failedToFetch'),\n          details: err,\n        },\n        'error',\n        4000,\n      )\n      return err\n    }\n  }\n\n  private handleRootDrop = (e: DragEvent) => {\n    forEachDroppedOrPastedUrl(e.dataTransfer!, 'drop', (url) => {\n      this.uppy.log(`[URL] Adding file from dropped url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  private handleRootPaste = (e: ClipboardEvent) => {\n    forEachDroppedOrPastedUrl(e.clipboardData!, 'paste', (url) => {\n      this.uppy.log(`[URL] Adding file from pasted url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  render(): ComponentChild {\n    return <UrlUI i18n={this.i18n} addFile={this.addFile} />\n  }\n\n  install(): void {\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall(): void {\n    this.unmount()\n  }\n}\n\n// This is defined outside of the class body because it's not using `this`, but\n// we still want it available on the prototype so the Dashboard can access it.\nUrl.prototype.canHandleRootDrop = canHandleRootDrop\n"],"mappings":"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","ignoreList":[]}