{"version":3,"names":["nanoid","packageJson","STATE_UPDATE","defaultSelector","id","state","uppy","getPatch","prev","next","nextKeys","Object","keys","patch","forEach","k","_id","_classPrivateFieldLooseKey","_selector","_store","ReduxStore","constructor","opts","defineProperty","writable","value","_classPrivateFieldLooseBase","store","selector","setState","dispatch","type","payload","getState","subscribe","cb","prevState","nextState","Symbol","for","VERSION","version","reducer","action","newState","middleware"],"sources":["index.js"],"sourcesContent":["import { nanoid } from 'nanoid/non-secure'\n\nimport packageJson from '../package.json'\n\n// Redux action name.\nexport const STATE_UPDATE = 'uppy/STATE_UPDATE'\n\n// Pluck Uppy state from the Redux store in the default location.\nconst defaultSelector = (id) => (state) => state.uppy[id]\n\nfunction getPatch (prev, next) {\n  const nextKeys = Object.keys(next)\n  const patch = {}\n  nextKeys.forEach((k) => {\n    if (prev[k] !== next[k]) patch[k] = next[k]\n  })\n  return patch\n}\n\n/**\n * Redux store.\n *\n * @param {object} opts.store - The Redux store to use.\n * @param {string} opts.id - This store instance's ID. Defaults to a random string.\n *    If you need to access Uppy state through Redux, eg. to render custom UI, set this to something constant.\n * @param {Function} opts.selector - Function, `(state) => uppyState`, to pluck state from the Redux store.\n *    Defaults to retrieving `state.uppy[opts.id]`. Override if you placed Uppy state elsewhere in the Redux store.\n */\nexport class ReduxStore {\n  static VERSION = packageJson.version\n\n  #id\n\n  #selector\n\n  #store\n\n  constructor (opts) {\n    this.#store = opts.store\n    this.#id = opts.id || nanoid()\n    this.#selector = opts.selector || defaultSelector(this.#id)\n\n    // Calling `setState` to dispatch an action to the Redux store.\n    // The intent is to make sure that the reducer has run once.\n    this.setState({})\n  }\n\n  setState (patch) {\n    this.#store.dispatch({\n      type: STATE_UPDATE,\n      id: this.#id,\n      payload: patch,\n    })\n  }\n\n  getState () {\n    return this.#selector(this.#store.getState())\n  }\n\n  subscribe (cb) {\n    let prevState = this.getState()\n    return this.#store.subscribe(() => {\n      const nextState = this.getState()\n      if (prevState !== nextState) {\n        const patch = getPatch(prevState, nextState)\n        cb(prevState, nextState, patch)\n        prevState = nextState\n      }\n    })\n  }\n\n  [Symbol.for('uppy test: get id')] () {\n    return this.#id\n  }\n}\n\nexport function reducer (state = {}, action) {\n  if (action.type === STATE_UPDATE) {\n    const newState = { ...state[action.id], ...action.payload }\n    return { ...state, [action.id]: newState }\n  }\n  return state\n}\n\nexport function middleware () {\n  // Do nothing, at the moment.\n  return () => (next) => (action) => {\n    next(action)\n  }\n}\n\nexport default ReduxStore\n"],"mappings":"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","ignoreList":[]}