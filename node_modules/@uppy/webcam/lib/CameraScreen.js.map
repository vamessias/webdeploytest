{"version":3,"names":["h","Component","SnapshotButton","RecordButton","RecordingLength","VideoSourceSelect","SubmitButton","DiscardButton","isModeAvailable","modes","mode","includes","CameraScreen","componentDidMount","onFocus","props","componentWillUnmount","onStop","render","src","recordedVideo","recording","supportsRecording","videoSources","showVideoSourceDropdown","showRecordingLength","onSubmit","i18n","mirror","onSnapshot","onStartRecording","onStopRecording","onDiscardRecordedVideo","recordingLengthSeconds","hasRecordedVideo","shouldShowRecordButton","shouldShowSnapshotButton","shouldShowRecordingLength","shouldShowVideoSourceDropdown","length","videoProps","playsInline","muted","controls","videoElement","srcObject","autoPlay","className","_extends","ref","onDiscard"],"sources":["CameraScreen.tsx"],"sourcesContent":["/* eslint-disable jsx-a11y/media-has-caption */\nimport type { I18n } from '@uppy/utils/lib/Translator'\nimport { h, Component, type ComponentChild } from 'preact'\nimport type { HTMLAttributes } from 'preact/compat'\nimport SnapshotButton from './SnapshotButton.tsx'\nimport RecordButton from './RecordButton.tsx'\nimport RecordingLength from './RecordingLength.tsx'\nimport VideoSourceSelect, {\n  type VideoSourceSelectProps,\n} from './VideoSourceSelect.tsx'\nimport SubmitButton from './SubmitButton.tsx'\nimport DiscardButton from './DiscardButton.tsx'\n\nfunction isModeAvailable<T>(modes: T[], mode: any): mode is T {\n  return modes.includes(mode)\n}\n\ninterface CameraScreenProps extends VideoSourceSelectProps {\n  onFocus: () => void\n  onStop: () => void\n\n  src: MediaStream | null\n  recording: boolean\n  recordedVideo: string | null\n  modes: string[]\n  supportsRecording: boolean\n  showVideoSourceDropdown: boolean\n  showRecordingLength: boolean\n  onSubmit: () => void\n  i18n: I18n\n  mirror: boolean\n  onSnapshot: () => void\n  onStartRecording: () => void\n  onStopRecording: () => void\n  onDiscardRecordedVideo: () => void\n  recordingLengthSeconds: number\n}\n\nclass CameraScreen extends Component<CameraScreenProps> {\n  private videoElement?: HTMLVideoElement\n\n  refs: any\n\n  componentDidMount(): void {\n    const { onFocus } = this.props\n    onFocus()\n  }\n\n  componentWillUnmount(): void {\n    const { onStop } = this.props\n    onStop()\n  }\n\n  render(): ComponentChild {\n    const {\n      src,\n      recordedVideo,\n      recording,\n      modes,\n      supportsRecording,\n      videoSources,\n      showVideoSourceDropdown,\n      showRecordingLength,\n      onSubmit,\n      i18n,\n      mirror,\n      onSnapshot,\n      onStartRecording,\n      onStopRecording,\n      onDiscardRecordedVideo,\n      recordingLengthSeconds,\n    } = this.props\n\n    const hasRecordedVideo = !!recordedVideo\n    const shouldShowRecordButton =\n      !hasRecordedVideo &&\n      supportsRecording &&\n      (isModeAvailable(modes, 'video-only') ||\n        isModeAvailable(modes, 'audio-only') ||\n        isModeAvailable(modes, 'video-audio'))\n    const shouldShowSnapshotButton =\n      !hasRecordedVideo && isModeAvailable(modes, 'picture')\n    const shouldShowRecordingLength =\n      supportsRecording && showRecordingLength && !hasRecordedVideo\n    const shouldShowVideoSourceDropdown =\n      showVideoSourceDropdown && videoSources && videoSources.length > 1\n\n    const videoProps: HTMLAttributes<HTMLVideoElement> = {\n      playsInline: true,\n    }\n\n    if (recordedVideo) {\n      videoProps.muted = false\n      videoProps.controls = true\n      videoProps.src = recordedVideo\n\n      // reset srcObject in dom. If not resetted, stream sticks in element\n      if (this.videoElement) {\n        this.videoElement.srcObject = null\n      }\n    } else {\n      videoProps.muted = true\n      videoProps.autoPlay = true\n      // @ts-expect-error srcObject does not exist on <video> props\n      videoProps.srcObject = src\n    }\n\n    return (\n      <div className=\"uppy uppy-Webcam-container\">\n        <div className=\"uppy-Webcam-videoContainer\">\n          <video\n            /* eslint-disable-next-line no-return-assign */\n            ref={(videoElement) => (this.videoElement = videoElement!)}\n            className={`uppy-Webcam-video  ${\n              mirror ? 'uppy-Webcam-video--mirrored' : ''\n            }`}\n            /* eslint-disable-next-line react/jsx-props-no-spreading */\n            {...videoProps}\n          />\n        </div>\n        <div className=\"uppy-Webcam-footer\">\n          <div className=\"uppy-Webcam-videoSourceContainer\">\n            {shouldShowVideoSourceDropdown ?\n              VideoSourceSelect(this.props)\n            : null}\n          </div>\n          <div className=\"uppy-Webcam-buttonContainer\">\n            {shouldShowSnapshotButton && (\n              <SnapshotButton onSnapshot={onSnapshot} i18n={i18n} />\n            )}\n\n            {shouldShowRecordButton && (\n              <RecordButton\n                recording={recording}\n                onStartRecording={onStartRecording}\n                onStopRecording={onStopRecording}\n                i18n={i18n}\n              />\n            )}\n\n            {hasRecordedVideo && (\n              <SubmitButton onSubmit={onSubmit} i18n={i18n} />\n            )}\n\n            {hasRecordedVideo && (\n              <DiscardButton onDiscard={onDiscardRecordedVideo} i18n={i18n} />\n            )}\n          </div>\n\n          <div className=\"uppy-Webcam-recordingLength\">\n            {shouldShowRecordingLength && (\n              <RecordingLength\n                recordingLengthSeconds={recordingLengthSeconds}\n                i18n={i18n}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default CameraScreen\n"],"mappings":"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","ignoreList":[]}