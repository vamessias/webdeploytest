{"version":3,"names":["h","UIPlugin","GooglePickerView","GoogleDriveIcon","RequestClient","tokenStorage","packageJson","locale","GoogleDrivePicker","constructor","uppy","opts","type","icon","defaultLocale","handleFilesPicked","files","accessToken","addFiles","map","_ref","id","mimeType","name","rest","source","data","size","isRemote","remote","companionUrl","url","body","fileId","requestClientId","render","storage","pickerType","clientId","apiKey","appId","onFilesPicked","i18nInit","title","i18n","client","pluginId","provider","companionHeaders","companionCookiesRule","registerRequestClient","install","target","mount","uninstall","unmount","_GoogleDrivePicker","VERSION","version"],"sources":["GoogleDrivePicker.tsx"],"sourcesContent":["import { h } from 'preact'\nimport { UIPlugin, Uppy } from '@uppy/core'\nimport { GooglePickerView } from '@uppy/provider-views'\nimport { GoogleDriveIcon } from '@uppy/provider-views/lib/GooglePicker/icons.js'\nimport {\n  RequestClient,\n  type CompanionPluginOptions,\n  tokenStorage,\n} from '@uppy/companion-client'\n\nimport type { PickedItem } from '@uppy/provider-views/lib/GooglePicker/googlePicker.js'\nimport type { Body, Meta } from '@uppy/utils/lib/UppyFile'\nimport type { AsyncStore, BaseProviderPlugin } from '@uppy/core/lib/Uppy.js'\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport packageJson from '../package.json'\nimport locale from './locale.ts'\n\nexport type GoogleDrivePickerOptions = CompanionPluginOptions & {\n  clientId: string\n  apiKey: string\n  appId: string\n}\n\nexport default class GoogleDrivePicker<\n    M extends Meta & { width: number; height: number },\n    B extends Body,\n  >\n  extends UIPlugin<GoogleDrivePickerOptions, M, B>\n  implements BaseProviderPlugin\n{\n  static VERSION = packageJson.version\n\n  static requestClientId = GoogleDrivePicker.name\n\n  type = 'acquirer'\n\n  icon = GoogleDriveIcon\n\n  storage: AsyncStore\n\n  defaultLocale = locale\n\n  constructor(uppy: Uppy<M, B>, opts: GoogleDrivePickerOptions) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'GoogleDrivePicker'\n    this.storage = this.opts.storage || tokenStorage\n\n    this.i18nInit()\n    this.title = this.i18n('pluginNameGoogleDrive')\n\n    const client = new RequestClient(uppy, {\n      pluginId: this.id,\n      provider: 'url',\n      companionUrl: this.opts.companionUrl,\n      companionHeaders: this.opts.companionHeaders,\n      companionCookiesRule: this.opts.companionCookiesRule,\n    })\n\n    this.uppy.registerRequestClient(GoogleDrivePicker.requestClientId, client)\n  }\n\n  install(): void {\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall(): void {\n    this.unmount()\n  }\n\n  private handleFilesPicked = async (\n    files: PickedItem[],\n    accessToken: string,\n  ) => {\n    this.uppy.addFiles(\n      files.map(({ id, mimeType, name, ...rest }) => {\n        return {\n          source: this.id,\n          name,\n          type: mimeType,\n          data: {\n            size: null, // defer to companion to determine size\n          },\n          isRemote: true,\n          remote: {\n            companionUrl: this.opts.companionUrl,\n            url: `${this.opts.companionUrl}/google-picker/get`,\n            body: {\n              fileId: id,\n              accessToken,\n              ...rest,\n            },\n            requestClientId: GoogleDrivePicker.requestClientId,\n          },\n        }\n      }),\n    )\n  }\n\n  render = () => (\n    <GooglePickerView\n      storage={this.storage}\n      pickerType=\"drive\"\n      uppy={this.uppy}\n      clientId={this.opts.clientId}\n      apiKey={this.opts.apiKey}\n      appId={this.opts.appId}\n      onFilesPicked={this.handleFilesPicked}\n    />\n  )\n}\n"],"mappings":"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","ignoreList":[]}